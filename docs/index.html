<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>LW - Character Selection</title>
    <link rel="stylesheet" href="styles.css?v=2">
  </head>
  <body>
    <script>
      // Apply states immediately to prevent flash
      (function() {
        // Handle panel state
        const savedPanelState = localStorage.getItem('lw-rpg-panel-collapsed');
        if (savedPanelState === 'true') {
          document.documentElement.classList.add('panel-will-be-collapsed');
        }
        
        // Handle character view state
        const savedCharacterState = sessionStorage.getItem('lw-rpg-state');
        if (savedCharacterState) {
          try {
            const state = JSON.parse(savedCharacterState);
            if (state.currentView === 'character-view' && state.characterData) {
              document.documentElement.classList.add('character-will-be-shown');
            }
          } catch (e) {
            // Invalid state, ignore
          }
        }
      })();
    </script>
    <div class="app-layout">
      <!-- Show Panel Button (hidden by default) -->
      <button id="show-panel-btn" class="show-panel-btn" style="display: none;">&gt;&gt;</button>
      
      <!-- Left Sidebar Panel -->
      <aside id="character-panel" class="character-panel">
        <div class="panel-sticky-header">
          <div class="panel-header">
            <h2>Characters</h2>
            <button id="panel-toggle" class="panel-toggle">&lt;&lt;</button>
          </div>
          
          <div class="search-filter-controls">
            <input type="text" id="character-search" placeholder="Search characters..." class="search-input">
            <select id="subclass-filter" class="filter-select">
              <option value="">All Subclasses</option>
            </select>
            <button id="clear-filters-btn" class="clear-filters-btn">Clear</button>
          </div>
        </div>
        
        <div id="character-list" class="character-list">
          <div class="loading">Loading characters...</div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="main-content">
        <header class="main-header">
          <div class="header-buttons">
            <button id="admin-link" class="admin-link">Admin</button>
          </div>
        </header>
        
        <!-- Welcome/Instructions Section -->
        <div id="welcome-section" class="welcome-section">
          <h2>Welcome to LW Character Manager</h2>
          <p>Select a character from the left panel to view and edit their stats, abilities, and portrait.</p>
        </div>

        <!-- Character View Section -->
        <div id="character-view-section" class="character-sheet" style="display: none;">
          <div class="character-header">
            <h2 id="character-name" class="character-name">&nbsp;</h2>
            <p id="character-subclass" class="character-subclass">&nbsp;</p>
          </div>
          
          <div class="character-content">
            <div class="character-portrait-section">
              <div class="portrait-container">
                <div class="portrait-wrapper">
                  <img id="character-portrait" class="character-portrait" src="default_profile.jpg" alt="Character Portrait">
                  <input type="file" id="portrait-upload" accept="image/*" style="display: none;">
                  <div class="portrait-overlay-controls">
                    <button id="upload-portrait-btn" class="portrait-control-btn upload-control" title="Upload Photo">+</button>
                    <button id="remove-portrait-btn" class="portrait-control-btn remove-control" title="Remove Photo" style="display: none;">Ã—</button>
                  </div>
                </div>
              </div>
              <div id="character-description" class="character-description">
                Character description will appear here...
              </div>
            </div>
            
            <div class="character-stats">
              <div class="stats-grid">
                <div class="stat-block">
                  <label>Health</label>
                  <input type="number" id="character-health" class="stat-input" value="0" min="0" max="255">
                </div>
                <div class="stat-block">
                  <label>Attack</label>
                  <input type="number" id="character-attack" class="stat-input" value="0" min="0" max="255">
                </div>
                <div class="stat-block">
                  <label>Defense</label>
                  <input type="number" id="character-defense" class="stat-input" value="0" min="0" max="255">
                </div>
                <div class="stat-block">
                  <label>Will</label>
                  <input type="number" id="character-will" class="stat-input" value="0" min="0" max="255">
                </div>
                <div class="stat-block">
                  <label>Speed</label>
                  <input type="number" id="character-speed" class="stat-input" value="0" min="0" max="255">
                </div>
                <div class="stat-block">
                  <label>Flying</label>
                  <input type="checkbox" id="character-flying" class="flying-checkbox">
                </div>
              </div>
              <button id="reset-stats-btn" class="reset-stats-btn">Reset Stats</button>
            </div>
          </div>
          
          <div class="character-abilities">
            <div class="abilities-header">
              <h3>Abilities & Attacks</h3>
              <div class="abilities-buttons">
                <button id="reset-abilities-btn" class="reset-abilities-btn">Reset Abilities</button>
                <button id="add-ability-btn" class="add-ability-btn">Add Ability</button>
              </div>
            </div>
            <div id="character-attacks" class="abilities-list">
              <div class="loading">Loading abilities...</div>
            </div>
          </div>
          
          <div class="character-companions" id="companions-section" style="display: none;">
            <h3>Companions</h3>
            <div id="character-companions" class="companions-list">
            </div>
          </div>

          <!-- Admin Controls (hidden by default) -->
          <div id="admin-controls" class="admin-controls" style="display: none;">
            <div class="admin-controls-header">
              <h3>Admin Actions</h3>
              <span class="admin-mode-indicator">Admin Mode Active</span>
            </div>
            <div class="admin-buttons">
              <button id="submit-character-btn" class="submit-character-btn">Submit Character to JSON</button>
              <button id="exit-admin-btn" class="exit-admin-btn">Exit Admin Mode</button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-modal" class="admin-modal" style="display: none;">
      <div class="admin-modal-content">
        <h2>Admin Access Required</h2>
        <form id="admin-login-form">
          <input type="password" id="admin-password" placeholder="Enter admin password" required>
          <div class="admin-form-buttons">
            <button type="button" id="cancel-admin-btn" class="cancel-admin-btn">Cancel</button>
            <button type="submit" class="access-admin-btn">Access Admin</button>
          </div>
        </form>
        <p id="admin-password-error" class="admin-password-error" style="display: none;">Incorrect password. Please try again.</p>
      </div>
    </div>
    
    <noscript>This page contains webassembly and javascript content, please enable javascript in your browser.</noscript>
    <script src="./bootstrap.js"></script>
  </body>
</html>
